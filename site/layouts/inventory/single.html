{{ define "title" }}{{ .Title }} | {{ .Site.Title }}{{ end }}
{{ define "description" }}{{ .Params.Year }} {{ .Params.Make }} {{ .Params.Model }} {{ .Params.Trim }} - {{ .Params.Mileage }} miles - {{ .Site.Title }}{{ end }}

{{ define "main" }}
<section class="vehicle-detail">
  <div class="container">
    <div class="vehicle-header">
      <h1>{{ .Title }}</h1>
      <div class="vehicle-price">${{ .Params.price }}</div>
    </div>
    
    <div class="vehicle-content">
      <div class="vehicle-gallery">
        {{ with .Params.images }}
          <div class="main-image">
            <img src="{{ index . 0 }}" alt="{{ $.Title }}" class="img-fluid">
          </div>
          {{ if gt (len .) 1 }}
          <div class="thumbnail-gallery">
            {{ range . }}
              <div class="thumbnail"></div>
                <img src="{{ . }}" alt="{{ $.Title }}" class="img-fluid lazyload">
              </div>
            {{ end }}
          </div>
          {{ end }}
        {{ end }}
      </div>
      
      <div class="vehicle-info">
        <div class="vehicle-specs">
          <div class="spec-group">
            <div class="spec-item">
              <span class="label">Year</span>
              <span class="value">{{ .Params.year }}</span>
            </div>
            <div class="spec-item">
              <span class="label">Make</span>
              <span class="value">{{ .Params.make }}</span>
            </div>
            <div class="spec-item">
              <span class="label">Model</span>
              <span class="value">{{ .Params.model }}</span>
            </div>
          </div>
          <div class="spec-group">
            <div class="spec-item">
              <span class="label">Mileage</span>
              <span class="value">{{ .Params.mileage }} mi</span>
            </div>
            <div class="spec-item">
              <span class="label">Exterior</span>
              <span class="value">{{ .Params.exteriorColor }}</span>
            </div>
            <div class="spec-item">
              <span class="label">Interior</span>
              <span class="value">{{ .Params.interiorColor }}</span>
            </div>
          </div>
          <div class="spec-group">
            <div class="spec-item">
              <span class="label">Transmission</span>
              <span class="value">{{ .Params.transmission }}</span>
            </div>
            <div class="spec-item">
              <span class="label">VIN</span>
              <span class="value">{{ .Params.vin }}</span>
            </div>
            <div class="spec-item">
              <span class="label">Stock #</span>
              <span class="value">{{ .Params.stockNumber }}</span>
            </div>
          </div>
        </div>
        
        <div class="vehicle-actions">
          <a href="/test-drive?vehicle={{ .Params.id }}" class="btn btn-primary">Schedule Test Drive</a>
          <a href="/contact?vehicle={{ .Params.id }}" class="btn btn-secondary">Ask About This Vehicle</a>
          <button class="btn btn-outline calculate-payment" 
                  data-price="{{ .Params.price }}" 
                  data-year="{{ .Params.year }}" 
                  data-make="{{ .Params.make }}"
                  data-model="{{ .Params.model }}">
            Calculate Payment
          </button>
        </div>
        
        <div class="vehicle-description">
          <h2>Description</h2>
          <div class="description-content">
            {{ .Params.description | markdownify }}
          </div>
        </div>
        
        <div class="vehicle-features">
          <h2>Features</h2>
          <ul class="features-list">
            {{ range .Params.features }}
              <li>{{ . }}</li>
            {{ end }}
          </ul>
        </div>
      </div>
    </div>
    
    <div class="related-vehicles">
      <h2>Similar Vehicles</h2>
      <div id="related-inventory" class="vehicle-carousel">
        <!-- Will be populated via JavaScript -->
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize payment calculator
    document.querySelector('.calculate-payment')?.addEventListener('click', function() {
      const vehicle = {
        price: this.dataset.price,
        year: this.dataset.year,
        make: this.dataset.make,
        model: this.dataset.model
      };
      
      showPaymentCalculator(vehicle);
    });
    
    // Load related inventory
    const relatedContainer = document.getElementById('related-inventory');
    if (relatedContainer) {
      loadRelatedVehicles({
        make: "{{ .Params.make }}",
        model: "{{ .Params.model }}",
        excludeId: "{{ .Params.id }}"
      }, relatedContainer);
    }
  });
  
  // Payment calculator modal
  function showPaymentCalculator(vehicle) {
    // Implementation will be added
  }
  
  // Load related vehicles based on current vehicle
  async function loadRelatedVehicles(params, container) {
    // Implementation will fetch from inventory API
  }
</script>
{{ end }}
